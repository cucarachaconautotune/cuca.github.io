<!DOCTYPE html>
<html>
  <head>
    <title>cuca clicker</title>
    <link href="/plo.css" rel="stylesheet">
  </head>
  <body>
    <h1>Cuca clicker</h1>
    <div id="cuenta">
      Nombre:<br>
      <input id="nombre"><br>
      Contraseña:<br>
      <input type="password" id="contraseña"><br>
      tengo que actualizar mas cosas para que funcione, plo<br>
      <button onclick="entrarcuenta()">Entrar</button><button onclick="crearcuenta()">Crear cuenta</button>
    </div>
    <button id="boton" onclick="contar()" style="padding: 0px;"><div id="carisia"></div></button>
    <p id="contador"></p>
    <script>
        let carisias;
        let animasion = document.getElementById("carisia");
        let contador = document.getElementById("contador");
        let nombre;
        let cuenta;
        document.getElementById("boton").style.display = "none";
        function ponertesto() {
            if (carisias == 0) {
                contador.innerText = "No has acariciado a la cuca :(";
            } else if (carisias == 1) {
                contador.innerText = "Has acariciado a la cuca 1 vez.";
            } else {
                contador.innerText = "Has acariciado a la cuca " + carisias + " veces.";
            }
        }
      
        function contar() {
            carisias = carisias + 1;
            ponertesto();
            carisia();
            animasion.style.animation = 'none';
            animasion.offsetHeight;
            animasion.style.animation = null;
            animasion.style.animationPlayState = 'running';
        }

        async function servidor(url) { //ni puta idea de como funciona esto lo he copiado de https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream
          return await fetch(url)
          .then((response) => response.body)
          .then((rb) => {
            const reader = rb.getReader();
        
            return new ReadableStream({
              start(controller) {
                // The following function handles each data chunk
                function push() {
                  // "done" is a Boolean and value a "Uint8Array"
                  reader.read().then(({ done, value }) => {
                    // If there is no more data to read
                    if (done) {
                      console.log("done", done);
                      controller.close();
                      return;
                    }
                    // Get the data and send it to the browser via the controller
                    controller.enqueue(value);
                    // Check chunks by logging to the console
                    console.log(done, value);
                    push();
                  });
                }
        
                push();
              },
            });
          })
          .then((stream) =>
            // Respond with our stream
            new Response(stream, { headers: { "Content-Type": "text/html" } }).text(),
          )
          .then((result) => {
            // Do things with result
            console.log(result);
            return result;
          });
        }
        async function carisia() {
            respuesta = (await servidor("https://cuca.rf.gd/carisiar.php?nombre=" + encodeURIComponent(nombre) + "&contraseña=" + encodeURIComponent(contraseña)));
            if (Number(respuesta)) {
                carisias = Number(respuesta);
                ponertesto();
            } else {
                contador.innerText = respuesta;
            }
        }
        async function entrarcuenta() {
            nombre = document.getElementById("nombre").value;
            contraseña = document.getElementById("contraseña").value;
            respuesta = (await servidor("https://cuca.rf.gd/cuenta.php?nombre=" + encodeURIComponent(nombre) + "&contraseña=" + encodeURIComponent(contraseña)));
            if (Number(respuesta) || Number(respuesta) == 0) {
                carisias = Number(respuesta);
                ponertesto();
                document.getElementById("boton").style.display = null;
                document.getElementById("cuenta").style.display = "none";
            } else {
                contador.innerText = respuesta;
            }
        }
        async function crearcuenta() {
            nombre = document.getElementById("nombre").value;
            contraseña = document.getElementById("contraseña").value;
            respuesta = (await servidor("https://cuca.rf.gd/crear.php?nombre=" + encodeURIComponent(nombre) + "&contraseña=" + encodeURIComponent(contraseña)));
            if (Number(respuesta) || Number(respuesta) == 0) {
                carisias = Number(respuesta);
                ponertesto();
                document.getElementById("boton").style.display = null;
                document.getElementById("cuenta").style.display = "none";
            } else {
                contador.innerText = respuesta;
            }
        }
    </script>
  </body>
</html>
