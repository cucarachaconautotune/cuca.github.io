<!DOCTYPE html>
<html>
  <head>
    <title>cuca clicker</title>
    <link href="/plo.css" rel="stylesheet">
  </head>
  <body>
    <h1>Cuca clicker</h1>
    <div id="cuenta">
      Nombre:<br>
      <input id="nombre"><br>
      Contraseña:<br>
      <input type="password" id="contraseña"><br>
      <button onclick="entrarcuenta()">Entrar</button><button onclick="crearcuenta()">Crear cuenta</button>
    </div>
    <button id="boton" onclick="contar()" style="padding: 0px;"><div id="carisia"></div></button>
    <p id="contador"></p>
    <script>
        let carisias;
        let animasion = document.getElementById("carisia");
        let contador = document.getElementById("contador");
        let nombre;
        let cuenta;
        document.getElementById("boton").style.display = "none";
        function ponertesto() {
            if (carisias == 0) {
                contador.innerText = "No has acariciado a la cuca :(";
            } else if (carisias == 1) {
                contador.innerText = "Has acariciado a la cuca 1 vez.";
            } else {
                contador.innerText = "Has acariciado a la cuca " + carisias + " veces.";
            }
        }
      
        function contar() {
            carisias = carisias + 1;
            ponertesto();
            carisia();
            animasion.style.animation = 'none';
            animasion.offsetHeight;
            animasion.style.animation = null;
            animasion.style.animationPlayState = 'running';
        }

        async function servidor(url) {
            pedido = new Request(url);
            respuesta = await fetch(pedido);
            str = "";
            for await (const chunk of respuesta.body) {
                str = str + new TextDecoder().decode(chunk);
            }
            return str;
        }
        async function carisia() {
            respuesta = (await servidor("https://45.90.13.219:6985/carisiar.php?nombre=" + encodeURIComponent(nombre) + "&contraseña=" + encodeURIComponent(contraseña)));
            if (Number(respuesta)) {
                carisias = Number(respuesta);
                ponertesto();
            } else {
                contador.innerText = respuesta;
            }
        }
        async function entrarcuenta() {
            nombre = document.getElementById("nombre").value;
            contraseña = document.getElementById("contraseña").value;
            respuesta = (await servidor("https://45.90.13.219:6985/cuenta.php?nombre=" + encodeURIComponent(nombre) + "&contraseña=" + encodeURIComponent(contraseña)));
            if (Number(respuesta)) {
                carisias = Number(respuesta);
                ponertesto();
                document.getElementById("boton").style.display = null;
                document.getElementById("cuenta").style.display = "none";
            } else {
                contador.innerText = respuesta;
            }
        }
        async function crearcuenta() {
            nombre = document.getElementById("nombre").value;
            contraseña = document.getElementById("contraseña").value;
            respuesta = (await servidor("https://45.90.13.219:6985/crear.php?nombre=" + encodeURIComponent(nombre) + "&contraseña=" + encodeURIComponent(contraseña)));
            if (Number(respuesta)) {
                carisias = Number(respuesta);
                ponertesto();
                document.getElementById("boton").style.display = null;
                document.getElementById("cuenta").style.display = "none";
            } else {
                contador.innerText = respuesta;
            }
        }
    </script>
  </body>
</html>
